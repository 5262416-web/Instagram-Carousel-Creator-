<!DOCTYPE html><html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Instagram Carousel Creator</title>
  <style>
    :root{--bg:#0f1115;--panel:#171a21;--ink:#e8ecf1;--muted:#98a2b3;--accent:#7c9cff;--line:#222736;--btn:#23293a;--warn:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,var(--bg),rgba(15,17,21,.6));backdrop-filter: blur(6px)}
    .wrap{max-width:960px;margin:0 auto;padding:12px}
    .col{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    textarea{width:100%;min-height:120px;resize:vertical;background:#0a0c12;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:10px;font-size:14px;line-height:1.5}
    select,input[type="number"],input[type="text"],input[type="color"]{width:100%;background:#0a0c12;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:8px}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn{appearance:none;border:1px solid var(--line);background:var(--btn);color:var(--ink);padding:10px 12px;border-radius:12px;font-weight:600}
    .btn.secondary{background:#0a0c12}
    .btn.warn{background:#2b0f13;border-color:#3a1218;color:#ffb4b4}
    .hint{color:var(--muted);font-size:12px}
    details{background:#0a0c12;border:1px solid var(--line);border-radius:12px;padding:10px}
    summary{cursor:pointer;color:var(--ink);font-weight:600}
    .slides{display:flex;flex-direction:column;gap:14px;margin-top:12px}
    .slideCard{position:relative;background:#0b0e15;border:1px solid var(--line);border-radius:14px;padding:10px}
    canvas.thumb{width:100%;height:auto;border-radius:10px;border:1px solid var(--line);background:#000;touch-action: pan-y}
    .cardActions{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:10px}
    .iconBtn{display:inline-flex;align-items:center;gap:8px}
    .iconBtn svg{width:18px;height:18px}
    footer{display:flex;justify-content:center;padding:24px}
    .clear{opacity:.8}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:999px;background:#101522;border:1px solid var(--line);font-size:12px;color:var(--muted)}
    .accent{color:var(--accent)}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:10px;flex:1 1 auto">
        <div class="badge">üì∏ Instagram Carousel Creator <span class="accent">1080√ó1350</span></div>
      </div>
    </div>
  </header>  <main class="wrap">
    <div class="col">
      <label for="story">–ò—Å—Ç–æ—Ä–∏—è (–∫–∞–∂–¥—ã–π —Å–ª–∞–π–¥ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–±–∑–∞—Ü, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–π –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π)</label>
      <textarea id="story" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏.\n\n–ö–∞–∂–¥—ã–π –∞–±–∑–∞—Ü —Å—Ç–∞–Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–ª–∞–π–¥–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–∂–∏—Ä–Ω—ã–π** –∏ *–∫—É—Ä—Å–∏–≤* –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏."></textarea><details style="margin-top:12px">
    <summary>–î–æ–ø. –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–∫—Å—Ç–∞</summary>
    <div class="controls" style="margin-top:10px">
      <div>
        <label>–®—Ä–∏—Ñ—Ç</label>
        <select id="fontFamily">
          <option value="Arial, sans-serif">Arial</option>
          <option value="'Helvetica Neue', Helvetica, Arial, sans-serif">Helvetica</option>
          <option value="Roboto, Arial, sans-serif">Roboto</option>
          <option value="'Open Sans', Arial, sans-serif">Open Sans</option>
          <option value="'PT Sans', Arial, sans-serif">PT Sans</option>
          <option value="Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif">Impact</option>
        </select>
      </div>
      <div>
        <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (px)</label>
        <input id="fontSize" type="number" min="16" max="96" step="1" value="40" />
      </div>
      <div>
        <label>–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ</label>
        <select id="textAlign">
          <option value="left">–°–ª–µ–≤–∞</option>
          <option value="center">–ü–æ —Ü–µ–Ω—Ç—Ä—É</option>
          <option value="right">–°–ø—Ä–∞–≤–∞</option>
        </select>
      </div>
      <div>
        <label>–û—Ç—Å—Ç—É–ø—ã —Ç–µ–∫—Å—Ç–∞ (px)</label>
        <input id="padding" type="number" min="0" max="160" value="64" />
      </div>
      <div>
        <label>–ú–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª</label>
        <input id="lineHeight" type="number" min="1" max="2.4" step="0.05" value="1.25" />
      </div>
      <div>
        <label>–û—Ç—Å—Ç—É–ø –æ—Ç –Ω–∏–∑–∞ (px)</label>
        <input id="textBottomOffset" type="number" min="0" max="400" value="130" />
      </div>
      <div>
        <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
        <input id="textColor" type="text" value="#ffffff" />
      </div>
      <div>
        <label>–¢–µ–Ω—å —Ç–µ–∫—Å—Ç–∞ (0‚Äì1)</label>
        <input id="textShadow" type="number" min="0" max="1" step="0.05" value="0.8" />
      </div>
    </div>
  </details>

  <div id="slides" class="slides"></div>
</div>

  </main>  <footer>
    <button id="clearBtn" class="btn warn clear">Clear Results ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)</button>
  </footer>  <input id="filePicker" type="file" accept="image/*" style="display:none" />  <script>
    const W=1080,H=1350; // 4:5
    const state={
      slides:[],
      settings:{
        fontFamily:'Arial, sans-serif',
        fontSize:40,
        textAlign:'left',
        padding:64,
        lineHeight:1.25,
        textColor:'#ffffff',
        textShadow:0.8,
        textBottomOffset:130,
      }
    };

    const elStory=document.getElementById('story');
    const elSlides=document.getElementById('slides');
    const elFile=document.getElementById('filePicker');

    // —Ä–∞–∑–±–∏–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∞–±–∑–∞—Ü—ã ‚Üí —Å–ª–∞–π–¥—ã
    function splitTextToSlides(t){
      const parts=t.replace(/\r/g,'').split(/\n\s*\n/g).map(s=>s.trim()).filter(Boolean);
      const old=state.slides;
      state.slides=parts.map((p,i)=>({text:p,imgSrc:(old[i]&&old[i].imgSrc)||undefined,_img:null}));
      renderSlidesList();renderAll();
    }
    elStory.addEventListener('input',()=>splitTextToSlides(elStory.value));

    function createSlideCard(index){
      const wrap=document.createElement('div');wrap.className='slideCard';
      const c=document.createElement('canvas');c.width=W;c.height=H;c.className='thumb';c.dataset.index=index;wrap.appendChild(c);
      const actions=document.createElement('div');actions.className='cardActions';
      const replaceBtn=document.createElement('button');replaceBtn.className='btn secondary';replaceBtn.textContent='Replace photo';replaceBtn.addEventListener('click',()=>replacePhoto(index));actions.appendChild(replaceBtn);
      const dlBtn=document.createElement('button');dlBtn.className='btn secondary iconBtn';dlBtn.title='–°–∫–∞—á–∞—Ç—å JPG';dlBtn.innerHTML=`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3a1 1 0 011 1v9.586l2.293-2.293a1 1 0 111.414 1.414l-4.001 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L11 13.586V4a1 1 0 011-1z"/><path d="M5 20a2 2 0 002 2h10a2 2 0 002-2v-3a1 1 0 10-2 0v3H7v-3a1 1 0 10-2 0v3z"/></svg>`;dlBtn.addEventListener('click',()=>downloadSlide(index));actions.appendChild(dlBtn);
      wrap.appendChild(actions);
      renderSlideCanvas(c,index);return wrap;
    }

    function renderSlidesList(){
      elSlides.innerHTML='';
      if(state.slides.length===0){const empty=document.createElement('div');empty.className='hint';empty.textContent='–ù–∞—á–Ω–∏—Ç–µ —Å —Ç–µ–∫—Å—Ç–∞ ‚Äî —Å–ª–∞–π–¥—ã –ø–æ—è–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.';elSlides.appendChild(empty);return}
      state.slides.forEach((_,i)=>elSlides.appendChild(createSlideCard(i)));
    }

    function renderAll(){document.querySelectorAll('canvas.thumb').forEach(cv=>renderSlideCanvas(cv,parseInt(cv.dataset.index,10)))}

    // –ø—Ä–æ—Å—Ç–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ **bold**/*italic*
    function parseInline(text){const tokens=[];let i=0;while(i<text.length){if(text.startsWith('**',i)||text.startsWith('__',i)){const m=text.substr(i,2),e=text.indexOf(m,i+2);if(e!==-1){tokens.push({t:text.slice(i+2,e),b:true,i:false});i=e+2;continue}}if(text[i]==='*'||text[i]==='_'){const m=text[i],e=text.indexOf(m,i+1);if(e!==-1){tokens.push({t:text.slice(i+1,e),b:false,i:true});i=e+1;continue}}let j=i;while(j<text.length&&!(text.startsWith('**',j)||text.startsWith('__',j)||text[j]==='*'||text[j]==='_'))j++;tokens.push({t:text.slice(i,j),b:false,i:false});i=j}return tokens}
    function setFont(ctx,fs,fam,b,i){ctx.font=`${b?'bold ':''}${i?'italic ':''}${fs}px ${fam}`}
    function layoutLines(ctx,tokens,maxW,fs,fam){const lines=[];let line=[],w=0;const meas=(txt,b,i)=>{setFont(ctx,fs,fam,b,i);return ctx.measureText(txt).width};for(const tok of tokens){const parts=tok.t.split(/(\s+)/);for(const p of parts){if(!p)continue;const ww=meas(p,tok.b,tok.i);if(w+ww>maxW&&line.length){lines.push({runs:line,width:w});line=[{text:p,b:tok.b,i:tok.i,w:ww}];w=ww}else{line.push({text:p,b:tok.b,i:tok.i,w:ww});w+=ww}}}if(line.length)lines.push({runs:line,width:w});return lines}

    function renderSlideCanvas(cv,index){
      const s=state.slides[index];const ctx=cv.getContext('2d');
      // —Ñ–æ–Ω
      ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);
      // —Ñ–æ—Ç–æ (cover)
      if(s.imgSrc){if(!s._img){s._img=new Image();s._img.onload=()=>renderSlideCanvas(cv,index);s._img.src=s.imgSrc;return}const img=s._img;const scale=Math.max(W/img.width,H/img.height);const dw=img.width*scale,dh=img.height*scale;const dx=(W-dw)/2,dy=(H-dh)/2;ctx.drawImage(img,dx,dy,dw,dh)}
      // –¢–ï–ö–°–¢ (–±–µ–∑ –ø–æ–¥–ª–æ–∂–∫–∏)
      const fs=state.settings.fontSize,lh=fs*state.settings.lineHeight,fam=state.settings.fontFamily;const pad=state.settings.padding,maxW=W-pad*2;const lines=layoutLines(ctx,parseInline(s.text||''),maxW,fs,fam);const bottom=H-state.settings.textBottomOffset;lines.forEach((line,i)=>{const y=bottom-(lines.length-1-i)*lh;let xStart=pad;if(state.settings.textAlign==='center')xStart=(W-line.width)/2;if(state.settings.textAlign==='right')xStart=W-pad-line.width;let x=xStart;for(const run of line.runs){setFont(ctx,fs,fam,!!run.b,!!run.i);ctx.fillStyle=state.settings.textColor;if(state.settings.textShadow>0){ctx.save();ctx.shadowColor=`rgba(0,0,0,${state.settings.textShadow})`;ctx.shadowBlur=12;ctx.shadowOffsetX=0;ctx.shadowOffsetY=0;ctx.fillText(run.text,x,y);ctx.restore()}else{ctx.fillText(run.text,x,y)}x+=run.w}})
    }

    function replacePhoto(index){
      elFile.onchange=async(e)=>{const f=e.target.files&&e.target.files[0];if(!f)return;const fr=new FileReader();fr.onload=()=>{state.slides[index].imgSrc=fr.result;state.slides[index]._img=null;renderAll();elFile.value=''};fr.readAsDataURL(f)};elFile.click()
    }

    function downloadSlide(index){const cv=document.querySelectorAll('canvas.thumb')[index];renderSlideCanvas(cv,index);const a=document.createElement('a');a.href=cv.toDataURL('image/jpeg',0.92);a.download=`slide-${index+1}.jpg`;document.body.appendChild(a);a.click();a.remove()}

    // CLEAR ‚Äî –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
    document.getElementById('clearBtn').addEventListener('click',()=>{
      if(!confirm('–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) return;
      state.slides=[];
      elStory.value='';
      // –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫ —É–º–æ–ª—á–∞–Ω–∏—è–º
      state.settings={fontFamily:'Arial, sans-serif',fontSize:40,textAlign:'left',padding:64,lineHeight:1.25,textColor:'#ffffff',textShadow:0.8,textBottomOffset:130};
      ['fontFamily','fontSize','textAlign','padding','lineHeight','textColor','textShadow','textBottomOffset'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=state.settings[id];});
      renderSlidesList();
    });

    // init
    renderSlidesList();
  </script></body>
</html>
